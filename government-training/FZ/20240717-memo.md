# DAY 1

점심시간: 12:50 ~ 


## 소개

### 자료 주소

1. [깃헙 메모](https://github.com/tangt64/training_memos/blob/main/government-training/FZ/20240717-memo.md)
2. [미로 주소](https://miro.com/app/board/uXjVKyb6PKQ=/?share_link_id=177277321540)
3. [다른 미로 주소](https://miro.com/welcomeonboard/MmlIbmUyVkhnWm1XdjhCdzFkc1o2emk5WEdubVdDM3VCNFZ1dlh0Y1hnQklmWEJRTjVXeGIyV3poQjVZN1RyNnwzNDU4NzY0NTg1NjQ5MDkwMzU0fDI=?share_link_id=218432405632)
4. [구글미팅](https://meet.google.com/ita-knxd-avj)

## 가상머신 구성

### ARM 맥 사용자

- [UTM 내려받기](https://mac.getutm.app/)
- [ARM 리눅스](https://download.rockylinux.org/pub/rocky/9/isos/aarch64/Rocky-9.4-aarch64-minimal.iso)

### 윈도우 사용자

하이퍼브이 기반으로 설치. 파워쉘에서 명령어로 설치가 가능.

- [x86_64 리눅스](https://download.rockylinux.org/pub/rocky/9/isos/x86_64/Rocky-9.4-x86_64-minimal.iso)
- [강사 컴퓨터 내려받기](http://192.168.0.18/)

```bash
Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V -All
```

## 호스트 설정

```bash
dnf install epel-release -y
dnf install hyperv-* -y

hostnamectl set-hostname node1.example.com

dnf search container-tools
> container-tools.noarch : A meta-package witch container tools such as podman, buildah, skopeo, etc.
dnf install container-tools -y
dnf search podman 
> podman-docker
> podman-compose
dnf install podman-docker podman-compose -y 

docker ps
podman ps
podman containert ls
```

### 테스트 컨테이너 생성

교안이 필요한 경우 아래로 접근
> https://github.com/tangt64/training_memos/tree/main/opensource-101/oci-podman-101

1. dnf(yum): 리눅스(레드햇 계열) 패키지 설치 명령어
2. hostnamectl: 호스트 이름 변경
3. 리눅스에서 많이 사용하는 표준 컨테이너 엔진 프로그램(docker=podman)

```bash
docker ps                     ## 컨테이너 목록 출력
podman container ls           ## 컨테이너 애플리케이션 목록

podman pod ls                 ## Pod(infra container) 컨테이너 목록
systemctl is-active podman.service
> inactive

systemctl is-active docker.service
> active


## positional command, 위치 명령어.

podman run -d  --name test-nginx --rm  nginx
           --    ----            ----  -----
           \     \               \     \
            \     \               \     `---> name of container image
             \     \               `---> delete when stop it.
              \     `---> container name
               `---> detached mode
podman container ls        
```

### 명령어 자동완성

```bash
rpm -qa | grep bash
> bash-5.1.8-9.el9.x86_64
dnf install bash-completion -y 
complete -rp
source /etc/profile

podman [tab][tab]
> run
> rm

dnf install bash-color-prompt -y
exit
ssh root@<IP>
```


### ZSH 설치

```bash
dnf install zsh -y					#MacOS
> https://ohmyz.sh/
usermod -s /usr/bin/zsh root
zsh
dnf install git -y
sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"


```

__포드만/도커__ 에서 쿠버네티스로 소프트웨어(서비스)를 배포. OCI규격에 맞게 지원하는지?


Podman: "__Pod Man__ ager"의 약자. 도커에서는 Pod자원을 독립적으로 생성 및 구현.

```bash
podman ---------.
                 \
Kuberbetes ---- POD == pause
               -----
               \
                `--- concept
```


```bash

docker --> dockerd --> containerd --> container-~

podman --> [관리엔진] ---.
                          `--> conmon --> runc --> test-nginx
                                       \
                                        `--> pause
```

```bash
podman run -d --name test-nginx -p8080:80 --rm nginx


cd ~
mkdir welcome-htdocs
echo "Hello Nginx" > welcome-htdocs/index.html

podman run -d --name test-nginx-volume -v /root/welcome-htdocs:/usr/share/nginx/html -p8081:80 --rm nginx
setenforce 0
curl localhost:8081


podman container stop --all
podman container rm --all
podman pod stop --all
podman pod rm --all

podman run -d --pod new:pod-nginx --name container-nginx -v /root/welcome-htdocs:/usr/share/nginx/html -p8080:80 --rm nginx

podman search tomcat
skopeo list-tags docker://docker.io/library/tomcat
> latest
podman run -d --name test-tomcat --rm docker.io/library/tomcat
podman container ls
> test-tomcat
podman logs test-tomcat

podman container stop --all
podman run -d --name test-tomcat -p8080:8080 --rm docker.io/library/tomcat

```

# DAY 2

## 사용할 자원 목록

__컨테이너 이미지__

1. quay.io/fedora/httpd-24
2. quay.io/centos/centos:stream9
3. quay.io/fedora/mariadb-105
4. quay.io/openshift-examples/tomcat-example:tomcat
5. quay.io/redhattraining/wordpress:5.3.0
6. docker.io/library/registry:latest
7. docker.io/library/tomcat:9.0


__소스코드__ 

- https://github.com/tangt64/spring-petclinic
- https://github.com/tangt64/gogs-patched
- 

## 포드만 기본 명령어

### podman run

"-p" 옵션은 실은 "port"가 아니라 "publish". 특히, "p"옵션은 두 가지로 나누어짐.

- -p: 명시된 포트를 외부:내부로 포워딩 한다.
- -P: expose된 포트(Containerfile)를 전부 포워딩 한다.


변수처리는 "-e"옵션을 사용하여 처리한다.

- -d: detach 
- rc: return count(rc)

컨테이너 이미지는 다음과 같은 정보 기반으로 내려받기 시도.

```bash
ls -l /etc/containers/registries.conf
grep -Ev '^#|^$' registries.conf

#
# dnf install nano -y
# 나노 에디터에서 저장은 ctrl+o, 종료는 ctrl+x.
#
nano /etc/containers/registries.conf

vi /etc/containers/registries.conf
> unqualified-search-registries = ["quay.io", "docker.io"]
> short-name-mode = "enforcing"
```

일반적으로 컨테이너 애플리케이션을 배포 혹은 구성 시, __기본이미지(base image)__ 를 통해서 구성.


### 워드프레스 + 데이터베이스 생성 및 구성

```bash
podman run -d --rm -P quay.io/fedora/httpd-24
podman run -d --rm -p 18080:8080 quay.io/fedora/httpd-24
podman container expose                             ## 옵션표에는 있지만, 지원안함. Containerfile

podman run -d --rm --name test-centos quay.io/centos/centos:stream9 sleep 10000
podman exec -it test-centos bash

podman run -d --rm -p18080:89 --name wordpress quay.io/redhattraining/wordpress:5.3.0
podman run -d --rm -P --name wordpress quay.io/redhattraining/wordpress:5.3.0

podman run -d --rm -p13306:3306 --name mariadb -e MYSQL_USER=wordpress -e MYSQL_PASSWORD=wordpress -e MYSQL_DATABASE=wordpress quay.io/fedora/mariadb-105:latest
podman run -d --rm --name test-mariadb quay.io/centos/centos:stream9 sleep 10000

#
# 데이터베이스 아이피 주소 확인
#
podman container inspect mariadb | grep -i ipaddress
> "IPAddress": "10.88.0.29"
podman exec -it test-mariadb bash
> dnf install iputils -y
> dnf install mariadb -y
> ping 10.88.0.X
> mariadb -uwordpress -pwordpress -h 10.88.0.29 -P3306
>> show databases;
>> use wordpress
>> show tables;
```

```bash
podman container stop --all
podman container rm --all
podman rmi --all

podman container ls --all
podman images
```



### 터미널 창 나누기

[터미널 창 나누기](https://learn.microsoft.com/ko-kr/windows/terminal/panes)

1. alt+shift+-: 수평으로 화면 나누기
2. alt+shift++: 수직으로 화면 나누기
3. ctrl+shift+w: 창 닫기


#### 질문

1. 아이피 부분(아이피 주소+포트번호)
2. 포트번호(iptables-save, S/D NAT)


### podman pod

```bash
podman pod create --publish 18080:80 --name pod-web-service

podman run -d --rm --pod pod-web-service --name wordpress quay.io/redhattraining/wordpress:5.3.0     ## 80(http),8080(https)
podman run -d --rm --name mariadb -e MYSQL_USER=wordpress -e MYSQL_PASSWORD=wordpress -e MYSQL_DATABASE=wordpress quay.io/fedora/mariadb-105:latest


podman container run -d --rm --pod pod-web-service --name container-httpd quay.io/fedora/httpd-24
```


## podman inspect

```bash
podman pod inspect pod-web-service
podman container inspect httpd-24
podman inspect 
```

### podman stop

```bash
podman container stop
podman pod stop 
```

### podman rm

```bash
podman rm
```

### podman images

```bash
podman images
```


### podman rmi

```bash
podman rmi
```

### podman volume

```bash
podman volume ls
```

### podman network

```bash
podman network ls
```

### podman pod+container

```bash

podman run --pod new: 

```

### podman generate

```bash
podman generate 
```


### podman play


```bash

podman kube play

```


# DAY 3

# DAY 4

# DAY 5

# DAY 6

# DAY 7

# DAY 8
